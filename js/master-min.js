var container,stats;var camera,scene,blockRenderer,renderer;var projector,plane,cube,controls;var mouse2D,mouse3D,ray,rollOveredFace,isShiftDown=false,theta=45,epsilon=45,isCtrlDown=false,heylookatme,centered=true,quickness=10;var rollOverMesh,rollOverMaterial,voxelPosition=new THREE.Vector3(),tmpVec=new THREE.Vector3();var cubeGeo,cubeMaterial;var i,intersector;var zoomfactor=3;var counter=0;var origpos={};var testpos={x:3,y:3,z:3};var testblocks1={0:{x:-1,y:1,z:1,color:3385568},1:{x:-1,y:2,z:2,color:3385568}};var testblocks2={0:{x:0,y:0,z:1,color:14811151},1:{x:0,y:1,z:2,color:14811151},2:{x:0,y:2,z:1,color:14811151}};var testblocks3={0:{x:1,y:1,z:1,color:2796390},1:{x:1,y:1,z:2,color:2796390},2:{x:1,y:2,z:1,color:2796390}};init();animate();function init(){camera=new THREE.PerspectiveCamera(25,window.innerWidth/window.innerHeight,1,10000);camera.position.set(200,200,200);scene=new THREE.Scene();cubeGeo=new THREE.CubeGeometry(50,50,50);cubeMaterial=new THREE.MeshBasicMaterial({color:3385568,opacity:0.5,transparent:true});cubeMaterial.ambient=cubeMaterial.color;projector=new THREE.Projector();plane=new THREE.Mesh(new THREE.PlaneGeometry(1000,1000,20,20),new THREE.MeshBasicMaterial({transparent:true,wireframe:true,color:0,opacity:0.5}));plane.rotation.x=-Math.PI/2;scene.add(plane);mouse2D=new THREE.Vector3(0,0,0);renderer=new THREE.CSS3DRenderer();renderer.setSize(window.innerWidth,window.innerHeight);renderer.domElement.style.position="absolute";renderer.domElement.style.top=0;document.body.appendChild(renderer.domElement);controls=new THREE.TrackballControls(camera,renderer);controls.rotateSpeed=0.5;controls.addEventListener("change",render);document.addEventListener("mousemove",onDocumentMouseMove,false);document.addEventListener("mousedown",onDocumentMouseDown,false);document.addEventListener("keydown",onDocumentKeyDown,false);document.addEventListener("keyup",onDocumentKeyUp,false);window.addEventListener("resize",onWindowResize,false);heylookatme=scene.position;testcube();constructor(testblocks1);constructor(testblocks2);constructor(testblocks3)}function onWindowResize(){camera.setLens(window.innerWidth,window.innerHeight);camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(a){a.preventDefault();mouse2D.x=(a.clientX/window.innerWidth)*2-1;mouse2D.y=-(a.clientY/window.innerHeight)*2+1}function onDocumentMouseDown(b){b.preventDefault();var a=ray.intersectObjects(scene.children);if(a.length>0){console.log(a);if(a[0].object!=plane){centered=false;lookat(intersector.object.position);boxcentering()}else{lookat(scene.position);centered=true;theta=45,epsilon=45}}}function lookat(d){if(d.x<0){var b=setInterval(function(){heylookatme.x>=d.x?clearInterval(b):heylookatme.x+=quickness},10)}if(d.x>0){var b=setInterval(function(){heylookatme.x<=d.x?clearInterval(b):heylookatme.x-=quickness},10)}if(d.y<0){var c=setInterval(function(){heylookatme.y>=d.y?clearInterval(c):heylookatme.y+=quickness},10)}if(d.y>0){var c=setInterval(function(){heylookatme.y<=d.y?clearInterval(c):heylookatme.y-=quickness},10)}if(d.z<0){var a=setInterval(function(){heylookatme.z>=d.z?clearInterval(a):heylookatme.z+=quickness},10)}if(d.z>0){var a=setInterval(function(){heylookatme.z<=d.z?clearInterval(a):heylookatme.z-=quickness},10)}}function boxcentering(){if(camera.position.x<1000&&camera.position.x>0){var b=setInterval(function(){camera.position.x>=1000?clearInterval(b):camera.position.x+=quickness},10)}if(camera.position.x>1000){var b=setInterval(function(){camera.position.x<=1000?clearInterval(b):camera.position.x-=quickness},10)}if(camera.position.x>-1000&&camera.position.x<0){var b=setInterval(function(){camera.position.x<=-1000?clearInterval(b):camera.position.x-=quickness},10)}if(camera.position.x<-1000){var b=setInterval(function(){camera.position.x>=-1000?clearInterval(b):camera.position.x+=quickness},10)}if(camera.position.z<1000&&camera.position.z>0){var c=setInterval(function(){camera.position.z>=1000?clearInterval(c):camera.position.z+=quickness},10)}if(camera.position.z>1000){var c=setInterval(function(){camera.position.z<=1000?clearInterval(c):camera.position.z-=quickness},10)}if(camera.position.z>-1000&&camera.position.z<0){var c=setInterval(function(){camera.position.z<=-1000?clearInterval(c):camera.position.z-=quickness},10)}if(camera.position.z<-1000){var c=setInterval(function(){camera.position.z>=-1000?clearInterval(c):camera.position.z+=quickness},10)}if(camera.position.y<800&&camera.position.y>0){var a=setInterval(function(){camera.position.y>=800?clearInterval(a):camera.position.y+=quickness},10)}if(camera.position.y>800){var a=setInterval(function(){camera.position.y<=800?clearInterval(a):camera.position.y-=quickness},10)}if(camera.position.y>-800&&camera.position.y<0){var a=setInterval(function(){camera.position.y<=-800?clearInterval(a):camera.position.y-=quickness},10)}if(camera.position.y<-800){var a=setInterval(function(){camera.position.y>=-800?clearInterval(a):camera.position.y+=quickness},10)}}function constructor(h){var f=0,d=0,c=0;for(var a in h){if(Math.abs(h[a].y)>d){d=Math.abs(h[a].y)}if(Math.abs(h[a].z)>c){c=Math.abs(h[a].z)}}console.log(f+" // "+d+" // "+c);var g=new THREE.CubeGeometry(50,d*50,c*50);var e=new THREE.Mesh(g);for(var a in h){cubeMaterial=new THREE.MeshBasicMaterial({color:h[a].color,opacity:0.5,transparent:true});var j=new THREE.Mesh(cubeGeo,cubeMaterial);j.position.y=(h[a].y*50)+25;j.position.z=(h[a].z*50)+25;j.matrixAutoUpdate=false;j.updateMatrix();e.add(j);e.position.x=h[a].x*50}e.geometry.computeBoundingBox()}function textgenerate(c){var a=document.createElement("div");a.className="element";a.innerHTML="hell yes!";var b=new THREE.CSS3DObject(a);b.position.x=100;b.position.y=100;b.position.z=100;scene.add(b)}function testcube(b){var f=document.createElement("div");f.className="cube";var c=document.createElement("div");c.className="front";f.appendChild(c);var g=document.createElement("div");g.className="back";f.appendChild(g);var j=document.createElement("div");j.className="right";f.appendChild(j);var d=document.createElement("div");d.className="left";f.appendChild(d);var h=document.createElement("div");h.className="top";f.appendChild(h);var a=document.createElement("div");a.className="bottom";f.appendChild(a);var e=new THREE.CSS3DObject(f);e.position.x=100;e.position.y=100;e.position.z=100;scene.add(e)}function onDocumentKeyDown(a){switch(a.keyCode){case 16:isShiftDown=true;break;case 18:isCtrlDown=true;break}}function onDocumentKeyUp(a){switch(a.keyCode){case 16:isShiftDown=false;break;case 18:isCtrlDown=false;break}}function animate(){requestAnimationFrame(animate);ray=projector.pickingRay(mouse2D.clone(),camera);if(centered){controls.update()}camera.lookAt(heylookatme);renderer.render(scene,camera)};